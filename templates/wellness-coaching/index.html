<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boedirep Wellness Coaching — Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --sage: #7A9E7E;
    --sage-light: #A8C5AC;
    --sage-dark: #5C7D60;
    --cream: #F5F0E8;
    --cream-dark: #EDE7D9;
    --warm-white: #FAFAF7;
    --charcoal: #2C2C2C;
    --charcoal-light: #4A4A4A;
    --muted: #8A8A8A;
    --border: #E0D9CE;
    --gold: #C9A84C;
    --red: #C0504D;
    --blue: #4A7FA5;
    --sidebar-w: 240px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background: var(--cream);
    color: var(--charcoal);
    min-height: 100vh;
    display: flex;
  }

  /* ── SIDEBAR ── */
  .sidebar {
    width: var(--sidebar-w);
    background: var(--charcoal);
    color: #fff;
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 100;
    transition: transform .3s ease;
  }
  .sidebar-logo {
    padding: 28px 24px 20px;
    border-bottom: 1px solid rgba(255,255,255,.08);
  }
  .sidebar-logo h1 {
    font-family: 'Playfair Display', serif;
    font-size: 17px;
    font-weight: 700;
    color: #fff;
    line-height: 1.2;
  }
  .sidebar-logo span { color: var(--sage-light); font-size: 11px; display: block; margin-top: 2px; letter-spacing: .05em; text-transform: uppercase; }
  .sidebar-nav { flex: 1; padding: 16px 0; overflow-y: auto; }
  .nav-section { padding: 16px 24px 6px; font-size: 10px; text-transform: uppercase; letter-spacing: .1em; color: rgba(255,255,255,.35); }
  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 24px; cursor: pointer;
    font-size: 13.5px; font-weight: 400; color: rgba(255,255,255,.65);
    transition: all .15s; border-left: 3px solid transparent;
  }
  .nav-item:hover { background: rgba(255,255,255,.05); color: #fff; }
  .nav-item.active { background: rgba(122,158,126,.15); color: #fff; border-left-color: var(--sage-light); }
  .nav-item .icon { font-size: 15px; width: 18px; text-align: center; }
  .sidebar-footer {
    padding: 16px 24px;
    border-top: 1px solid rgba(255,255,255,.08);
    font-size: 12px; color: rgba(255,255,255,.4);
  }
  .conn-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; background: #ccc; }
  .conn-dot.connected { background: var(--sage-light); }

  /* ── MAIN ── */
  .main {
    margin-left: var(--sidebar-w);
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  .topbar {
    background: var(--warm-white);
    border-bottom: 1px solid var(--border);
    padding: 16px 32px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 50;
  }
  .topbar h2 { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 600; }
  .topbar-actions { display: flex; gap: 10px; align-items: center; }
  .btn {
    padding: 8px 18px; border-radius: 6px; border: none; cursor: pointer;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; font-weight: 500;
    transition: all .15s;
  }
  .btn-primary { background: var(--sage); color: #fff; }
  .btn-primary:hover { background: var(--sage-dark); }
  .btn-secondary { background: var(--cream-dark); color: var(--charcoal); border: 1px solid var(--border); }
  .btn-secondary:hover { background: var(--border); }
  .btn-sm { padding: 6px 14px; font-size: 12px; }
  .btn-danger { background: var(--red); color: #fff; }

  .content { padding: 32px; flex: 1; }

  /* ── PAGES ── */
  .page { display: none; }
  .page.active { display: block; }

  /* ── STATS GRID ── */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 28px; }
  .stat-card {
    background: var(--warm-white); border: 1px solid var(--border);
    border-radius: 10px; padding: 20px 22px;
  }
  .stat-label { font-size: 11.5px; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; margin-bottom: 6px; }
  .stat-value { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 600; }
  .stat-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }
  .stat-up { color: var(--sage-dark); }
  .stat-down { color: var(--red); }

  /* ── CARDS ── */
  .card {
    background: var(--warm-white); border: 1px solid var(--border);
    border-radius: 10px; overflow: hidden; margin-bottom: 20px;
  }
  .card-header {
    padding: 16px 22px; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }
  .card-title { font-family: 'Playfair Display', serif; font-size: 16px; font-weight: 600; }
  .card-body { padding: 20px 22px; }

  /* ── TABLE ── */
  .table-wrap { overflow-x: auto; }
  table { width: 100%; border-collapse: collapse; font-size: 13px; }
  th { padding: 10px 14px; text-align: left; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: .05em; color: var(--muted); border-bottom: 2px solid var(--border); background: var(--cream); }
  td { padding: 11px 14px; border-bottom: 1px solid var(--border); color: var(--charcoal-light); }
  tr:hover td { background: var(--cream); }
  tr:last-child td { border-bottom: none; }

  /* ── BADGE ── */
  .badge {
    display: inline-block; padding: 3px 10px; border-radius: 12px;
    font-size: 11px; font-weight: 500; text-transform: uppercase; letter-spacing: .03em;
  }
  .badge-open { background: #EFF6F0; color: var(--sage-dark); }
  .badge-converted { background: #EEF5FB; color: var(--blue); }
  .badge-lost { background: #FAEAEA; color: var(--red); }
  .badge-replied { background: #FFF8EC; color: #B07D20; }
  .badge-lead { background: #F3F0F8; color: #6B5B9A; }
  .badge-interested { background: #E8F5F0; color: #2E7D5E; }
  .badge-qualified { background: #EFF6F0; color: var(--sage-dark); }
  .badge-unqualified { background: #FAEAEA; color: var(--red); }
  .badge-inprocess { background: #FFF8EC; color: #B07D20; }
  .badge-active { background: #EFF6F0; color: var(--sage-dark); }
  .badge-disabled { background: #F0F0F0; color: var(--muted); }
  .badge-company { background: #EEF5FB; color: var(--blue); }
  .badge-individual { background: #F3F0F8; color: #6B5B9A; }

  /* ── SEARCH ── */
  .search-bar {
    display: flex; gap: 10px; margin-bottom: 16px; align-items: center;
  }
  .search-input {
    flex: 1; padding: 9px 14px; border: 1px solid var(--border); border-radius: 6px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; background: var(--warm-white);
    outline: none;
  }
  .search-input:focus { border-color: var(--sage); }
  .filter-select {
    padding: 9px 14px; border: 1px solid var(--border); border-radius: 6px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; background: var(--warm-white);
    outline: none; cursor: pointer;
  }

  /* ── MODAL ── */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.4); z-index: 200; align-items: center; justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--warm-white); border-radius: 12px; width: 560px; max-width: 95vw;
    max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,.2);
  }
  .modal-header {
    padding: 22px 24px 16px; border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }
  .modal-title { font-family: 'Playfair Display', serif; font-size: 18px; font-weight: 600; }
  .modal-close { background: none; border: none; font-size: 20px; cursor: pointer; color: var(--muted); }
  .modal-body { padding: 24px; }
  .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: flex-end; }

  /* ── FORM ── */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .form-group { margin-bottom: 16px; }
  .form-group.full { grid-column: 1 / -1; }
  label { display: block; font-size: 12px; font-weight: 600; color: var(--charcoal-light); margin-bottom: 5px; text-transform: uppercase; letter-spacing: .04em; }
  input[type="text"], input[type="email"], input[type="tel"], input[type="number"],
  select, textarea {
    width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 6px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 13px; background: var(--cream);
    outline: none; transition: border-color .15s;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--sage); background: var(--warm-white); }
  textarea { resize: vertical; min-height: 80px; }

  /* ── TOAST ── */
  #toast {
    position: fixed; bottom: 24px; right: 24px; z-index: 9999;
    background: var(--charcoal); color: #fff;
    padding: 12px 20px; border-radius: 8px; font-size: 13px;
    transform: translateY(60px); opacity: 0; transition: all .3s;
  }
  #toast.show { transform: translateY(0); opacity: 1; }
  #toast.success { background: var(--sage-dark); }
  #toast.error { background: var(--red); }

  /* ── LOADING ── */
  .loading { text-align: center; padding: 40px; color: var(--muted); font-size: 14px; }
  .skeleton { background: linear-gradient(90deg, var(--cream-dark) 25%, var(--cream) 50%, var(--cream-dark) 75%); background-size: 200% 100%; animation: shimmer 1.4s infinite; border-radius: 4px; height: 14px; margin: 8px 0; }
  @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

  /* ── TWO-COL GRID ── */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

  /* ── DETAIL PANEL ── */
  .detail-row { display: flex; align-items: flex-start; gap: 8px; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
  .detail-row:last-child { border-bottom: none; }
  .detail-key { color: var(--muted); min-width: 140px; font-size: 12px; font-weight: 500; }
  .detail-val { color: var(--charcoal); flex: 1; }

  /* ── PAGINATION ── */
  .pagination { display: flex; gap: 6px; align-items: center; margin-top: 16px; justify-content: flex-end; }
  .page-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 5px; background: var(--warm-white); cursor: pointer; font-size: 12px; }
  .page-btn:hover { background: var(--cream-dark); }
  .page-btn.active { background: var(--sage); color: #fff; border-color: var(--sage); }
  .page-info { font-size: 12px; color: var(--muted); margin: 0 8px; }

  /* ── MOBILE ── */
  .hamburger { display: none; background: none; border: none; cursor: pointer; font-size: 22px; }
  @media (max-width: 900px) {
    .sidebar { transform: translateX(-100%); }
    .sidebar.open { transform: translateX(0); }
    .main { margin-left: 0; }
    .hamburger { display: block; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .two-col, .three-col { grid-template-columns: 1fr; }
    .form-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 600px) {
    .stats-grid { grid-template-columns: 1fr; }
    .content { padding: 16px; }
  }

  .empty-state { text-align: center; padding: 48px 20px; color: var(--muted); }
  .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
  .empty-state p { font-size: 14px; }

  .avatar {
    width: 34px; height: 34px; border-radius: 50%; background: var(--sage-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 600; color: #fff; flex-shrink: 0;
  }

  .tab-bar { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 20px; }
  .tab-btn {
    padding: 10px 20px; cursor: pointer; font-size: 13px; font-weight: 500;
    color: var(--muted); border-bottom: 2px solid transparent; margin-bottom: -2px;
    background: none; border-top: none; border-left: none; border-right: none;
    font-family: 'Plus Jakarta Sans', sans-serif; transition: all .15s;
  }
  .tab-btn.active { color: var(--sage-dark); border-bottom-color: var(--sage-dark); }
  .tab-pane { display: none; }
  .tab-pane.active { display: block; }
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <h1>Boedirep<br>Wellness</h1>
    <span>Coaching Dashboard</span>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">Main</div>
    <div class="nav-item active" data-page="dashboard"><span class="icon">⊞</span> Dashboard</div>
    <div class="nav-item" data-page="leads"><span class="icon">◎</span> Leads</div>
    <div class="nav-item" data-page="customers"><span class="icon">✦</span> Customers</div>
    <div class="nav-section">Finance</div>
    <div class="nav-item" data-page="invoices"><span class="icon">◈</span> Invoices</div>
    <div class="nav-section">Operations</div>
    <div class="nav-item" data-page="support"><span class="icon">◇</span> Support Tickets</div>
    <div class="nav-item" data-page="hr"><span class="icon">◉</span> HR & Staff</div>
  </nav>
  <div class="sidebar-footer">
    <span class="conn-dot" id="connDot"></span>
    <span id="connStatus">Connecting…</span>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:14px;">
      <button class="hamburger" id="hamburger">☰</button>
      <h2 id="pageTitle">Dashboard</h2>
    </div>
    <div class="topbar-actions" id="topbarActions"></div>
  </div>

  <div class="content">

    <!-- ───── DASHBOARD PAGE ───── -->
    <div class="page active" id="page-dashboard">
      <div class="stats-grid" id="dashStats">
        <div class="stat-card"><div class="stat-label">Total Leads</div><div class="stat-value" id="stat-leads">—</div><div class="stat-sub">All time</div></div>
        <div class="stat-card"><div class="stat-label">Customers</div><div class="stat-value" id="stat-customers">—</div><div class="stat-sub">Active clients</div></div>
        <div class="stat-card"><div class="stat-label">Open Invoices</div><div class="stat-value" id="stat-invoices">—</div><div class="stat-sub">Unpaid</div></div>
        <div class="stat-card"><div class="stat-label">Support Tickets</div><div class="stat-value" id="stat-tickets">—</div><div class="stat-sub">Open</div></div>
      </div>

      <div class="two-col">
        <div class="card">
          <div class="card-header"><span class="card-title">Recent Leads</span><button class="btn btn-secondary btn-sm" onclick="navigate('leads')">View All</button></div>
          <div class="card-body" id="recentLeads"><div class="loading">Loading…</div></div>
        </div>
        <div class="card">
          <div class="card-header"><span class="card-title">Recent Customers</span><button class="btn btn-secondary btn-sm" onclick="navigate('customers')">View All</button></div>
          <div class="card-body" id="recentCustomers"><div class="loading">Loading…</div></div>
        </div>
      </div>
    </div>

    <!-- ───── LEADS PAGE ───── -->
    <div class="page" id="page-leads">
      <div class="search-bar">
        <input class="search-input" type="text" id="leadSearch" placeholder="Search leads by name, email, company…" oninput="filterLeads()">
        <select class="filter-select" id="leadStatusFilter" onchange="filterLeads()">
          <option value="">All Statuses</option>
          <option>Lead</option><option>Open</option><option>Replied</option>
          <option>Opportunity</option><option>Quotation</option><option>Interested</option>
          <option>Converted</option><option>Lost Quotation</option><option>Do Not Contact</option>
        </select>
        <select class="filter-select" id="leadQualFilter" onchange="filterLeads()">
          <option value="">All Qualification</option>
          <option>Unqualified</option><option>In Process</option><option>Qualified</option>
        </select>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Leads <span id="leadCount" style="font-size:13px;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-weight:400;"></span></span>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalLead')">+ New Lead</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th><th>Company</th><th>Email</th><th>Phone</th>
                <th>Status</th><th>Qualification</th><th>Source</th><th>Owner</th>
              </tr>
            </thead>
            <tbody id="leadsTableBody"><tr><td colspan="8"><div class="loading">Loading leads…</div></td></tr></tbody>
          </table>
        </div>
        <div style="padding:12px 22px;" id="leadPagination"></div>
      </div>
    </div>

    <!-- ───── CUSTOMERS PAGE ───── -->
    <div class="page" id="page-customers">
      <div class="search-bar">
        <input class="search-input" type="text" id="customerSearch" placeholder="Search customers by name, group, territory…" oninput="filterCustomers()">
        <select class="filter-select" id="customerTypeFilter" onchange="filterCustomers()">
          <option value="">All Types</option>
          <option>Company</option><option>Individual</option><option>Partnership</option>
        </select>
        <select class="filter-select" id="customerGroupFilter" onchange="filterCustomers()">
          <option value="">All Groups</option>
        </select>
      </div>

      <div class="card">
        <div class="card-header">
          <span class="card-title">Customers <span id="customerCount" style="font-size:13px;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;font-weight:400;"></span></span>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalCustomer')">+ New Customer</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th><th>Type</th><th>Group</th><th>Territory</th>
                <th>Email</th><th>Mobile</th><th>Account Manager</th><th>Status</th>
              </tr>
            </thead>
            <tbody id="customersTableBody"><tr><td colspan="8"><div class="loading">Loading customers…</div></td></tr></tbody>
          </table>
        </div>
        <div style="padding:12px 22px;" id="customerPagination"></div>
      </div>
    </div>

    <!-- ───── INVOICES PAGE ───── -->
    <div class="page" id="page-invoices">
      <div class="search-bar">
        <input class="search-input" type="text" id="invoiceSearch" placeholder="Search invoices…" oninput="filterInvoices()">
        <select class="filter-select" id="invoiceStatusFilter" onchange="filterInvoices()">
          <option value="">All</option><option>Draft</option><option>Submitted</option><option>Paid</option><option>Overdue</option>
        </select>
      </div>
      <div class="card">
        <div class="card-header">
          <span class="card-title">Sales Invoices</span>
          <button class="btn btn-primary btn-sm" onclick="openModal('modalInvoice')">+ New Invoice</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Invoice #</th><th>Customer</th><th>Date</th><th>Due Date</th><th>Amount</th><th>Status</th></tr></thead>
            <tbody id="invoicesTableBody"><tr><td colspan="6"><div class="loading">Loading invoices…</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ───── SUPPORT PAGE ───── -->
    <div class="page" id="page-support">
      <div class="card">
        <div class="card-header"><span class="card-title">Support Tickets</span></div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Ticket</th><th>Subject</th><th>Customer</th><th>Status</th><th>Priority</th><th>Created</th></tr></thead>
            <tbody id="ticketsTableBody"><tr><td colspan="6"><div class="loading">Loading…</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ───── HR PAGE ───── -->
    <div class="page" id="page-hr">
      <div class="card">
        <div class="card-header"><span class="card-title">Staff / Employees</span></div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>Designation</th><th>Department</th><th>Email</th><th>Status</th></tr></thead>
            <tbody id="hrTableBody"><tr><td colspan="5"><div class="loading">Loading…</div></td></tr></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- ───────── MODALS ───────── -->

<!-- LEAD MODAL -->
<div class="modal-overlay" id="modalLead">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">New Lead</span>
      <button class="modal-close" onclick="closeModal('modalLead')">×</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group"><label>First Name</label><input type="text" id="lf_first_name" placeholder="First name"></div>
        <div class="form-group"><label>Last Name</label><input type="text" id="lf_last_name" placeholder="Last name"></div>
        <div class="form-group"><label>Email</label><input type="email" id="lf_email_id" placeholder="email@example.com"></div>
        <div class="form-group"><label>Mobile No</label><input type="tel" id="lf_mobile_no" placeholder="+62..."></div>
        <div class="form-group"><label>WhatsApp</label><input type="tel" id="lf_whatsapp_no" placeholder="+62..."></div>
        <div class="form-group"><label>Phone</label><input type="tel" id="lf_phone" placeholder="Office phone"></div>
        <div class="form-group"><label>Organization Name</label><input type="text" id="lf_company_name" placeholder="Company (if applicable)"></div>
        <div class="form-group"><label>Job Title</label><input type="text" id="lf_job_title" placeholder="Position"></div>
        <div class="form-group"><label>Status</label>
          <select id="lf_status">
            <option>Lead</option><option>Open</option><option>Replied</option>
            <option>Opportunity</option><option>Quotation</option><option>Interested</option>
            <option>Converted</option><option>Lost Quotation</option><option>Do Not Contact</option>
          </select>
        </div>
        <div class="form-group"><label>Lead Type</label>
          <select id="lf_type"><option value="">— Select —</option><option>Client</option><option>Channel Partner</option><option>Consultant</option></select>
        </div>
        <div class="form-group"><label>Request Type</label>
          <select id="lf_request_type"><option value="">— Select —</option><option>Product Enquiry</option><option>Request for Information</option><option>Suggestions</option><option>Other</option></select>
        </div>
        <div class="form-group"><label>Qualification Status</label>
          <select id="lf_qualification_status"><option>Unqualified</option><option>In Process</option><option>Qualified</option></select>
        </div>
        <div class="form-group"><label>City</label><input type="text" id="lf_city" placeholder="City"></div>
        <div class="form-group"><label>Country</label><input type="text" id="lf_country" placeholder="Country"></div>
        <div class="form-group"><label>Website</label><input type="text" id="lf_website" placeholder="https://..."></div>
        <div class="form-group"><label>No. of Employees</label>
          <select id="lf_no_of_employees"><option value="">— Select —</option><option>1-10</option><option>11-50</option><option>51-200</option><option>201-500</option><option>501-1000</option><option>1000+</option></select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modalLead')">Cancel</button>
      <button class="btn btn-primary" onclick="saveLead()">Save Lead</button>
    </div>
  </div>
</div>

<!-- CUSTOMER MODAL -->
<div class="modal-overlay" id="modalCustomer">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">New Customer</span>
      <button class="modal-close" onclick="closeModal('modalCustomer')">×</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Customer Name *</label><input type="text" id="cf_customer_name" placeholder="Full name or company name"></div>
        <div class="form-group"><label>Customer Type *</label>
          <select id="cf_customer_type"><option>Company</option><option>Individual</option><option>Partnership</option></select>
        </div>
        <div class="form-group"><label>Customer Group</label><input type="text" id="cf_customer_group" placeholder="e.g. Wellness Client"></div>
        <div class="form-group"><label>Territory</label><input type="text" id="cf_territory" placeholder="e.g. Indonesia"></div>
        <div class="form-group"><label>Email</label><input type="email" id="cf_email" placeholder="email@example.com"></div>
        <div class="form-group"><label>Mobile No</label><input type="tel" id="cf_mobile_no" placeholder="+62..."></div>
        <div class="form-group"><label>Account Manager</label><input type="text" id="cf_account_manager" placeholder="User email"></div>
        <div class="form-group"><label>Website</label><input type="text" id="cf_website" placeholder="https://..."></div>
        <div class="form-group"><label>Industry</label><input type="text" id="cf_industry" placeholder="Industry type"></div>
        <div class="form-group"><label>Market Segment</label><input type="text" id="cf_market_segment" placeholder="Segment"></div>
        <div class="form-group"><label>Tax ID</label><input type="text" id="cf_tax_id" placeholder="NPWP / Tax number"></div>
        <div class="form-group"><label>Billing Currency</label><input type="text" id="cf_default_currency" placeholder="IDR / USD"></div>
        <div class="form-group full"><label>Customer Details</label><textarea id="cf_customer_details" placeholder="Additional notes about this customer…"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modalCustomer')">Cancel</button>
      <button class="btn btn-primary" onclick="saveCustomer()">Save Customer</button>
    </div>
  </div>
</div>

<!-- INVOICE MODAL -->
<div class="modal-overlay" id="modalInvoice">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title">New Sales Invoice</span>
      <button class="modal-close" onclick="closeModal('modalInvoice')">×</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Customer *</label><input type="text" id="if_customer" placeholder="Customer name"></div>
        <div class="form-group"><label>Posting Date</label><input type="date" id="if_posting_date"></div>
        <div class="form-group"><label>Due Date</label><input type="date" id="if_due_date"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modalInvoice')">Cancel</button>
      <button class="btn btn-primary" onclick="saveInvoice()">Save Invoice</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<script>
// ─── CONFIG ───────────────────────────────────────
const SITE = 'https://boedirep.jh.frappe.cloud';
const API_KEY = '8efad55bcd23082';
const API_SECRET = '809abef2d2111d0';

const headers = {
  'Authorization': `token ${API_KEY}:${API_SECRET}`,
  'Content-Type': 'application/json'
};

// ─── STATE ────────────────────────────────────────
let allLeads = [], filteredLeads = [], leadPage = 1, LEADS_PER_PAGE = 20;
let allCustomers = [], filteredCustomers = [], customerPage = 1, CUST_PER_PAGE = 20;
let allInvoices = [], filteredInvoices = [];
let connected = false;

// ─── API ─────────────────────────────────────────
async function api(endpoint) {
  try {
    const r = await fetch(`${SITE}${endpoint}`, { headers });
    if (!r.ok) throw new Error(r.status);
    const d = await r.json();
    return d.data || d.message || d;
  } catch(e) {
    console.warn('API error:', e);
    return null;
  }
}

async function apiPost(endpoint, body) {
  try {
    const r = await fetch(`${SITE}${endpoint}`, { method: 'POST', headers, body: JSON.stringify(body) });
    const d = await r.json();
    if (!r.ok) throw new Error(d.exception || d.message || r.status);
    return d.data || d.message || d;
  } catch(e) {
    throw e;
  }
}

// ─── CONNECTION CHECK ─────────────────────────────
async function checkConnection() {
  const dot = document.getElementById('connDot');
  const label = document.getElementById('connStatus');
  const r = await api('/api/method/frappe.auth.get_logged_user');
  connected = !!r;
  dot.className = 'conn-dot' + (connected ? ' connected' : '');
  label.textContent = connected ? 'Connected' : 'Offline';
}

// ─── NAVIGATION ──────────────────────────────────
function navigate(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelector(`[data-page="${page}"]`).classList.add('active');
  document.getElementById('pageTitle').textContent = {
    dashboard: 'Dashboard', leads: 'Leads', customers: 'Customers',
    invoices: 'Invoices', support: 'Support Tickets', hr: 'HR & Staff'
  }[page] || page;
  // Close mobile sidebar
  document.getElementById('sidebar').classList.remove('open');
  loadPage(page);
}

document.querySelectorAll('.nav-item').forEach(n => {
  n.addEventListener('click', () => navigate(n.dataset.page));
});
document.getElementById('hamburger').addEventListener('click', () => {
  document.getElementById('sidebar').classList.toggle('open');
});

// ─── LEADS ───────────────────────────────────────
async function loadLeads() {
  const fields = ['name','lead_name','first_name','last_name','company_name','email_id',
    'mobile_no','phone','status','qualification_status','utm_source','lead_owner',
    'job_title','city','country','type','request_type','whatsapp_no','creation'];
  const data = await api(`/api/resource/Lead?fields=${JSON.stringify(fields)}&limit=500&order_by=creation desc`);
  allLeads = data || [];
  filteredLeads = [...allLeads];
  renderLeads();
  updateDashLeads();
}

function statusBadge(status) {
  const map = {
    'Lead': 'lead', 'Open': 'open', 'Replied': 'replied',
    'Opportunity': 'inprocess', 'Quotation': 'inprocess',
    'Interested': 'interested', 'Converted': 'converted',
    'Lost Quotation': 'lost', 'Do Not Contact': 'lost'
  };
  return `<span class="badge badge-${map[status]||'open'}">${status||'—'}</span>`;
}

function qualBadge(q) {
  if (!q) return '—';
  const map = {'Unqualified':'unqualified','In Process':'inprocess','Qualified':'qualified'};
  return `<span class="badge badge-${map[q]||'open'}">${q}</span>`;
}

function renderLeads() {
  const tbody = document.getElementById('leadsTableBody');
  document.getElementById('leadCount').textContent = `(${filteredLeads.length})`;
  if (!filteredLeads.length) {
    tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="icon">◎</div><p>No leads found</p></div></td></tr>`;
    document.getElementById('leadPagination').innerHTML = '';
    return;
  }
  const start = (leadPage - 1) * LEADS_PER_PAGE;
  const page = filteredLeads.slice(start, start + LEADS_PER_PAGE);
  tbody.innerHTML = page.map(l => `
    <tr>
      <td><div style="display:flex;align-items:center;gap:8px;">
        <div class="avatar">${(l.lead_name||l.first_name||'?')[0].toUpperCase()}</div>
        <div><div style="font-weight:500;font-size:13px;">${l.lead_name||`${l.first_name||''} ${l.last_name||''}`.trim()||'—'}</div>
        <div style="font-size:11px;color:var(--muted);">${l.job_title||''}</div></div>
      </div></td>
      <td>${l.company_name||'—'}</td>
      <td>${l.email_id||'—'}</td>
      <td>${l.mobile_no||l.phone||'—'}</td>
      <td>${statusBadge(l.status)}</td>
      <td>${qualBadge(l.qualification_status)}</td>
      <td>${l.utm_source||'—'}</td>
      <td style="font-size:12px;color:var(--muted);">${(l.lead_owner||'').split('@')[0]||'—'}</td>
    </tr>
  `).join('');

  // Pagination
  const totalPages = Math.ceil(filteredLeads.length / LEADS_PER_PAGE);
  renderPagination('leadPagination', leadPage, totalPages, p => { leadPage = p; renderLeads(); });
}

function filterLeads() {
  const q = document.getElementById('leadSearch').value.toLowerCase();
  const s = document.getElementById('leadStatusFilter').value;
  const qs = document.getElementById('leadQualFilter').value;
  filteredLeads = allLeads.filter(l => {
    const matchQ = !q || [l.lead_name,l.email_id,l.company_name,l.mobile_no,l.first_name,l.last_name].some(v => (v||'').toLowerCase().includes(q));
    const matchS = !s || l.status === s;
    const matchQs = !qs || l.qualification_status === qs;
    return matchQ && matchS && matchQs;
  });
  leadPage = 1;
  renderLeads();
}

async function saveLead() {
  const firstName = document.getElementById('lf_first_name').value.trim();
  const lastName = document.getElementById('lf_last_name').value.trim();
  const companyName = document.getElementById('lf_company_name').value.trim();
  if (!firstName && !companyName) return showToast('First name or organization required', 'error');

  const body = {
    first_name: firstName,
    last_name: lastName,
    company_name: companyName,
    email_id: document.getElementById('lf_email_id').value.trim(),
    mobile_no: document.getElementById('lf_mobile_no').value.trim(),
    whatsapp_no: document.getElementById('lf_whatsapp_no').value.trim(),
    phone: document.getElementById('lf_phone').value.trim(),
    job_title: document.getElementById('lf_job_title').value.trim(),
    status: document.getElementById('lf_status').value,
    type: document.getElementById('lf_type').value,
    request_type: document.getElementById('lf_request_type').value,
    qualification_status: document.getElementById('lf_qualification_status').value,
    city: document.getElementById('lf_city').value.trim(),
    country: document.getElementById('lf_country').value.trim(),
    website: document.getElementById('lf_website').value.trim(),
    no_of_employees: document.getElementById('lf_no_of_employees').value,
    doctype: 'Lead'
  };

  try {
    await apiPost('/api/resource/Lead', body);
    showToast('Lead saved successfully', 'success');
    closeModal('modalLead');
    loadLeads();
  } catch(e) {
    showToast('Error: ' + (e.message||'Save failed'), 'error');
  }
}

// ─── CUSTOMERS ───────────────────────────────────
async function loadCustomers() {
  const fields = ['name','customer_name','customer_type','customer_group','territory',
    'email_id','mobile_no','account_manager','industry','market_segment','website',
    'disabled','default_currency','creation'];
  const data = await api(`/api/resource/Customer?fields=${JSON.stringify(fields)}&limit=500&order_by=creation desc`);
  allCustomers = data || [];
  filteredCustomers = [...allCustomers];

  // Populate group filter
  const groups = [...new Set(allCustomers.map(c => c.customer_group).filter(Boolean))];
  const gf = document.getElementById('customerGroupFilter');
  gf.innerHTML = '<option value="">All Groups</option>' + groups.map(g => `<option>${g}</option>`).join('');

  renderCustomers();
  updateDashCustomers();
}

function customerTypeBadge(t) {
  const map = {'Company':'company','Individual':'individual','Partnership':'replied'};
  return `<span class="badge badge-${map[t]||'open'}">${t||'—'}</span>`;
}

function renderCustomers() {
  const tbody = document.getElementById('customersTableBody');
  document.getElementById('customerCount').textContent = `(${filteredCustomers.length})`;
  if (!filteredCustomers.length) {
    tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><div class="icon">✦</div><p>No customers found</p></div></td></tr>`;
    document.getElementById('customerPagination').innerHTML = '';
    return;
  }
  const start = (customerPage - 1) * CUST_PER_PAGE;
  const page = filteredCustomers.slice(start, start + CUST_PER_PAGE);
  tbody.innerHTML = page.map(c => `
    <tr>
      <td><div style="display:flex;align-items:center;gap:8px;">
        <div class="avatar" style="background:var(--blue);">${(c.customer_name||'?')[0].toUpperCase()}</div>
        <span style="font-weight:500;font-size:13px;">${c.customer_name||'—'}</span>
      </div></td>
      <td>${customerTypeBadge(c.customer_type)}</td>
      <td>${c.customer_group||'—'}</td>
      <td>${c.territory||'—'}</td>
      <td>${c.email_id||'—'}</td>
      <td>${c.mobile_no||'—'}</td>
      <td style="font-size:12px;color:var(--muted);">${(c.account_manager||'').split('@')[0]||'—'}</td>
      <td>${c.disabled ? '<span class="badge badge-disabled">Disabled</span>' : '<span class="badge badge-active">Active</span>'}</td>
    </tr>
  `).join('');

  const totalPages = Math.ceil(filteredCustomers.length / CUST_PER_PAGE);
  renderPagination('customerPagination', customerPage, totalPages, p => { customerPage = p; renderCustomers(); });
}

function filterCustomers() {
  const q = document.getElementById('customerSearch').value.toLowerCase();
  const t = document.getElementById('customerTypeFilter').value;
  const g = document.getElementById('customerGroupFilter').value;
  filteredCustomers = allCustomers.filter(c => {
    const mQ = !q || [c.customer_name,c.customer_group,c.territory,c.email_id].some(v => (v||'').toLowerCase().includes(q));
    const mT = !t || c.customer_type === t;
    const mG = !g || c.customer_group === g;
    return mQ && mT && mG;
  });
  customerPage = 1;
  renderCustomers();
}

async function saveCustomer() {
  const name = document.getElementById('cf_customer_name').value.trim();
  if (!name) return showToast('Customer name required', 'error');

  const body = {
    customer_name: name,
    customer_type: document.getElementById('cf_customer_type').value,
    customer_group: document.getElementById('cf_customer_group').value.trim(),
    territory: document.getElementById('cf_territory').value.trim(),
    account_manager: document.getElementById('cf_account_manager').value.trim(),
    website: document.getElementById('cf_website').value.trim(),
    industry: document.getElementById('cf_industry').value.trim(),
    market_segment: document.getElementById('cf_market_segment').value.trim(),
    tax_id: document.getElementById('cf_tax_id').value.trim(),
    default_currency: document.getElementById('cf_default_currency').value.trim(),
    customer_details: document.getElementById('cf_customer_details').value.trim(),
    doctype: 'Customer'
  };

  try {
    await apiPost('/api/resource/Customer', body);
    showToast('Customer saved successfully', 'success');
    closeModal('modalCustomer');
    loadCustomers();
  } catch(e) {
    showToast('Error: ' + (e.message||'Save failed'), 'error');
  }
}

// ─── INVOICES ─────────────────────────────────────
async function loadInvoices() {
  const fields = ['name','customer','posting_date','due_date','grand_total','status','docstatus'];
  const data = await api(`/api/resource/Sales Invoice?fields=${JSON.stringify(fields)}&limit=200&order_by=creation desc`);
  allInvoices = data || [];
  filteredInvoices = [...allInvoices];
  renderInvoices();
}

function renderInvoices() {
  const tbody = document.getElementById('invoicesTableBody');
  if (!filteredInvoices.length) {
    tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="icon">◈</div><p>No invoices found</p></div></td></tr>`;
    return;
  }
  tbody.innerHTML = filteredInvoices.map(inv => {
    const statusMap = {0:'Draft',1:'Submitted',2:'Cancelled'};
    const st = inv.status || statusMap[inv.docstatus] || 'Draft';
    const stClass = {'Paid':'active','Overdue':'lost','Submitted':'inprocess','Draft':'unqualified'}[st]||'open';
    return `<tr>
      <td style="font-weight:500;">${inv.name}</td>
      <td>${inv.customer||'—'}</td>
      <td>${inv.posting_date||'—'}</td>
      <td>${inv.due_date||'—'}</td>
      <td style="font-weight:500;">IDR ${(inv.grand_total||0).toLocaleString()}</td>
      <td><span class="badge badge-${stClass}">${st}</span></td>
    </tr>`;
  }).join('');
}

function filterInvoices() {
  const q = document.getElementById('invoiceSearch').value.toLowerCase();
  const s = document.getElementById('invoiceStatusFilter').value;
  filteredInvoices = allInvoices.filter(i => {
    const mQ = !q || (i.customer||'').toLowerCase().includes(q) || (i.name||'').toLowerCase().includes(q);
    const mS = !s || (i.status||'').includes(s);
    return mQ && mS;
  });
  renderInvoices();
}

async function saveInvoice() {
  const customer = document.getElementById('if_customer').value.trim();
  if (!customer) return showToast('Customer required', 'error');
  try {
    await apiPost('/api/resource/Sales Invoice', {
      customer,
      posting_date: document.getElementById('if_posting_date').value,
      due_date: document.getElementById('if_due_date').value,
      doctype: 'Sales Invoice'
    });
    showToast('Invoice created', 'success');
    closeModal('modalInvoice');
    loadInvoices();
  } catch(e) {
    showToast('Error: ' + (e.message||'Failed'), 'error');
  }
}

// ─── SUPPORT ──────────────────────────────────────
async function loadTickets() {
  const data = await api('/api/resource/HD Ticket?fields=["name","subject","customer","status","priority","creation"]&limit=100&order_by=creation desc');
  const tbody = document.getElementById('ticketsTableBody');
  if (!data || !data.length) { tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><p>No tickets found</p></div></td></tr>`; return; }
  tbody.innerHTML = data.map(t => {
    const pc = {'Low':'open','Medium':'replied','High':'lost','Critical':'lost'}[t.priority]||'open';
    return `<tr>
      <td style="font-weight:500;">${t.name}</td>
      <td>${t.subject||'—'}</td>
      <td>${t.customer||'—'}</td>
      <td><span class="badge badge-${t.status==='Closed'?'converted':'inprocess'}">${t.status||'Open'}</span></td>
      <td><span class="badge badge-${pc}">${t.priority||'—'}</span></td>
      <td style="font-size:12px;color:var(--muted);">${(t.creation||'').split(' ')[0]}</td>
    </tr>`;
  }).join('');
  document.getElementById('stat-tickets').textContent = data.filter(t => t.status !== 'Closed').length;
}

// ─── HR ───────────────────────────────────────────
async function loadHR() {
  const data = await api('/api/resource/Employee?fields=["name","employee_name","designation","department","company_email","status"]&limit=100');
  const tbody = document.getElementById('hrTableBody');
  if (!data || !data.length) { tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><p>No employees found</p></div></td></tr>`; return; }
  tbody.innerHTML = data.map(e => `
    <tr>
      <td><div style="display:flex;align-items:center;gap:8px;">
        <div class="avatar" style="background:var(--gold);">${(e.employee_name||'?')[0].toUpperCase()}</div>
        <span>${e.employee_name||e.name}</span>
      </div></td>
      <td>${e.designation||'—'}</td>
      <td>${e.department||'—'}</td>
      <td>${e.company_email||'—'}</td>
      <td><span class="badge badge-${e.status==='Active'?'active':'disabled'}">${e.status||'—'}</span></td>
    </tr>
  `).join('');
}

// ─── DASHBOARD WIDGETS ────────────────────────────
function updateDashLeads() {
  document.getElementById('stat-leads').textContent = allLeads.length;
  const recent = allLeads.slice(0, 5);
  const el = document.getElementById('recentLeads');
  if (!recent.length) { el.innerHTML = '<div class="empty-state"><p>No leads yet</p></div>'; return; }
  el.innerHTML = recent.map(l => `
    <div class="detail-row">
      <div class="detail-key">${l.lead_name||`${l.first_name||''} ${l.last_name||''}`.trim()||'—'}<br><span style="font-size:11px;color:var(--muted);">${l.company_name||l.email_id||''}</span></div>
      <div class="detail-val" style="text-align:right;">${statusBadge(l.status)}</div>
    </div>
  `).join('');
}

function updateDashCustomers() {
  document.getElementById('stat-customers').textContent = allCustomers.filter(c => !c.disabled).length;
  const recent = allCustomers.slice(0, 5);
  const el = document.getElementById('recentCustomers');
  if (!recent.length) { el.innerHTML = '<div class="empty-state"><p>No customers yet</p></div>'; return; }
  el.innerHTML = recent.map(c => `
    <div class="detail-row">
      <div class="detail-key">${c.customer_name||'—'}<br><span style="font-size:11px;color:var(--muted);">${c.customer_group||''} · ${c.territory||''}</span></div>
      <div class="detail-val" style="text-align:right;">${customerTypeBadge(c.customer_type)}</div>
    </div>
  `).join('');
}

// ─── PAGE LOADER ──────────────────────────────────
const loaded = {};
function loadPage(page) {
  if (loaded[page]) return;
  loaded[page] = true;
  if (page === 'leads') loadLeads();
  else if (page === 'customers') loadCustomers();
  else if (page === 'invoices') loadInvoices();
  else if (page === 'support') loadTickets();
  else if (page === 'hr') loadHR();
}

// ─── PAGINATION HELPER ────────────────────────────
function renderPagination(elId, current, total, onChange) {
  if (total <= 1) { document.getElementById(elId).innerHTML = ''; return; }
  let html = '';
  html += `<span class="page-info">Page ${current} of ${total}</span>`;
  if (current > 1) html += `<button class="page-btn" onclick="(${onChange.toString()})(${current-1})">‹ Prev</button>`;
  const start = Math.max(1, current - 2), end = Math.min(total, current + 2);
  for (let p = start; p <= end; p++) {
    html += `<button class="page-btn${p===current?' active':''}" onclick="(${onChange.toString()})(${p})">${p}</button>`;
  }
  if (current < total) html += `<button class="page-btn" onclick="(${onChange.toString()})(${current+1})">Next ›</button>`;
  document.getElementById(elId).innerHTML = `<div class="pagination">${html}</div>`;
}

// ─── MODAL HELPERS ────────────────────────────────
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(m => {
  m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); });
});

// ─── TOAST ───────────────────────────────────────
let toastTimer;
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'show ' + type;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.className = '', 3000);
}

// ─── INIT ─────────────────────────────────────────
async function init() {
  await checkConnection();
  // Load dashboard data
  await Promise.all([loadLeads(), loadCustomers()]);
  // Load invoice count
  const invData = await api('/api/resource/Sales Invoice?fields=["name","status"]&limit=200');
  if (invData) {
    allInvoices = invData;
    filteredInvoices = [...invData];
    document.getElementById('stat-invoices').textContent = invData.filter(i => i.status !== 'Paid').length;
    // preload for invoices page
    document.getElementById('invoicesTableBody').innerHTML = '';
    renderInvoices();
    loaded['invoices'] = true;
  }
}

init();
</script>
</body>
</html>
